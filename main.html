<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>متجري — ملف واحد</title>
<style>
  :root{
    --bg:#0f172a;--card:#111827;--muted:#94a3b8;--text:#e5e7eb;--brand:#06b6d4;--brand2:#22d3ee;--ok:#22c55e;--warn:#f59e0b;--danger:#ef4444;
    --radius:20px
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(120deg,#0b1022,#0f172a 40%,#0b1323);font-family:system-ui,Segoe UI,Roboto,Arial; color:var(--text);}
  a{color:inherit}
  .container{max-width:1100px;margin:0 auto;padding:16px}
  header{position:sticky;top:0;z-index:50;background:rgba(15,23,42,.55);backdrop-filter: blur(10px);border-bottom:1px solid #1f2937}
  .nav{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px 4px}
  .brand{display:flex;align-items:center;gap:10px;font-weight:800;font-size:20px}
  .logo{width:34px;height:34px;border-radius:12px;background:conic-gradient(from 0deg,var(--brand),var(--brand2));display:grid;place-items:center;color:#041014;font-weight:900}
  .tools{display:flex;gap:8px;flex-wrap:wrap}
  .chip{background:#0b1222;border:1px solid #1f2937;color:var(--muted);padding:10px 12px;border-radius:12px;display:flex;gap:8px;align-items:center}
  .chip input, .chip select{background:transparent;border:none;outline:none;color:#e5e7eb}
  .chip input::placeholder{color:#64748b}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
  @media(max-width:980px){.grid{grid-template-columns:repeat(3,1fr)}}
  @media(max-width:720px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media(max-width:480px){.grid{grid-template-columns:1fr}}
  .card{background:linear-gradient(180deg,#0e152a,#0a1020);border:1px solid #1f2937;border-radius:var(--radius);overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .img{aspect-ratio:4/3;background:#0a1326;display:grid;place-items:center;border-bottom:1px solid #1f2937}
  .img svg{width:64px;height:64px;opacity:.7}
  .content{padding:14px}
  .title{font-weight:700}
  .muted{color:var(--muted);font-size:13px}
  .price{display:flex;align-items:center;gap:8px;margin-top:8px}
  .badge{font-size:12px;color:#0b1222;background:linear-gradient(90deg,var(--brand),var(--brand2));padding:4px 8px;border-radius:999px}
  .row{display:flex;justify-content:space-between;align-items:center;gap:10px}
  .btn{cursor:pointer;background:#0b1222;border:1px solid #1f2937;color:#e5e7eb;padding:10px 12px;border-radius:12px}
  .btn:hover{border-color:#334155}
  .btn.brand{background:linear-gradient(120deg,var(--brand),var(--brand2));color:#061019;border:none}
  .btn.small{padding:6px 10px;font-size:13px}
  /* cart drawer */
  .cart-toggle{position:fixed;right:16px;bottom:16px;z-index:60}
  .fab{display:flex;align-items:center;gap:8px;padding:12px 14px;border-radius:999px;background:linear-gradient(120deg,var(--brand),var(--brand2));color:#041014;border:none;box-shadow:0 10px 30px rgba(0,0,0,.35);font-weight:800;cursor:pointer}
  .drawer{position:fixed;inset:0 0 0 auto;width:min(420px,100%);background:linear-gradient(180deg,#0a1020,#0b1222);border-left:1px solid #1f2937;transform:translateX(105%);transition:.35s ease;z-index:70;display:flex;flex-direction:column}
  .drawer.open{transform:translateX(0)}
  .drawer header{position:sticky;top:0;border-bottom:1px solid #1f2937;background:transparent}
  .drawer .body{padding:16px;display:flex;flex-direction:column;gap:10px;overflow:auto}
  .item{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;background:#0b1426;border:1px solid #1f2937;border-radius:14px;padding:10px}
  .qty{display:flex;align-items:center;gap:6px}
  .qty button{width:28px;height:28px;border-radius:8px;border:1px solid #273244;background:#0b1222;color:#e5e7eb;cursor:pointer}
  .line{display:flex;justify-content:space-between;color:#cbd5e1}
  .total{font-size:20px;font-weight:900}
  .coupon{display:flex;gap:8px}
  .coupon input{flex:1}
  .foot{padding:16px;border-top:1px solid #1f2937;display:grid;gap:8px}
  .note{font-size:12px;color:#94a3b8}
  /* toast */
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:92px;background:#0b1426;border:1px solid #1f2937;padding:10px 14px;border-radius:12px;color:#e5e7eb;box-shadow:0 10px 24px rgba(0,0,0,.3);opacity:0;pointer-events:none;transition:.3s}
  .toast.show{opacity:1}
  /* modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:80;padding:16px}
  .modal.open{display:flex}
  .modal .box{width:min(520px,100%);background:#0b1426;border:1px solid #1f2937;border-radius:20px;padding:16px;display:grid;gap:10px}
  .form{display:grid;gap:10px}
  .form .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .form input, .form textarea{background:#0a1020;border:1px solid #1f2937;color:#e5e7eb;padding:10px;border-radius:12px;outline:none}
  .whats{display:flex;gap:8px}
  .whats input{flex:1}
  .empty{padding:24px;border:1px dashed #334155;border-radius:14px;text-align:center;color:#94a3b8}
  footer{opacity:.7;font-size:12px;margin:24px 0;text-align:center}
</style>
</head>
<body>

<header>
  <div class="container nav">
    <div class="brand">
      <div class="logo">🛍️</div>
      <span>متجري</span>
    </div>
    <div class="tools">
      <label class="chip"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="#94a3b8" stroke-width="2" stroke-linecap="round"/></svg>
        <input id="search" placeholder="بحث عن منتج..." />
      </label>
      <label class="chip">
        التصنيف
        <select id="category">
          <option value="all">الكل</option>
        </select>
      </label>
      <button class="chip btn small" id="reset">إعادة ضبط</button>
    </div>
  </div>
</header>

<main class="container" style="padding-top:18px">
  <div id="products" class="grid"></div>
  <footer>نسخة تجريبية بملف واحد — تحفظ السلة تلقائياً على جهازك.</footer>
</main>

<!-- Cart Floating Button -->
<div class="cart-toggle">
  <button class="fab" id="openCart">
    <span id="cartCount">0</span> في السلة
  </button>
</div>

<!-- Cart Drawer -->
<aside class="drawer" id="drawer">
  <header class="nav container">
    <div class="brand"><div class="logo">🧾</div><span>سلة المشتريات</span></div>
    <button class="btn small" id="closeCart">إغلاق</button>
  </header>
  <div class="body" id="cartBody"></div>
  <div class="foot">
    <div class="coupon">
      <input id="coupon" placeholder="كود خصم (مثال: SAVE10)" />
      <button class="btn small" id="applyCoupon">تطبيق</button>
    </div>
    <div class="line"><span>الإجمالي الفرعي</span><span id="subTotal">0</span></div>
    <div class="line"><span>الخصم</span><span id="discount">0</span></div>
    <div class="line"><span>التوصيل</span><span id="shipping">0</span></div>
    <div class="line total"><span>المجموع</span><span id="grandTotal">0</span></div>
    <button class="btn brand" id="checkoutBtn">إتمام الطلب</button>
    <div class="note">الدفع عند الاستلام أو عبر واتساب. الأسعار بالـ <b>IQD</b>.</div>
  </div>
</aside>

<!-- Checkout Modal -->
<div class="modal" id="modal">
  <div class="box">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h3 style="margin:0">إتمام الطلب</h3>
      <button class="btn small" id="closeModal">إغلاق</button>
    </div>
    <form class="form" id="checkoutForm">
      <div class="row2">
        <input required id="name" placeholder="الاسم الكامل" />
        <input required id="phone" placeholder="رقم الهاتف" />
      </div>
      <input required id="city" placeholder="المدينة" />
      <textarea required id="address" rows="3" placeholder="العنوان الكامل"></textarea>
      <div class="whats">
        <input id="whatsNumber" placeholder="رقم واتساب (اختياري لإرسال الطلب)" />
        <button type="button" class="btn small" id="sendWhats">إرسال واتساب</button>
      </div>
      <button class="btn brand" type="submit">تأكيد الطلب (دفع عند الاستلام)</button>
      <div class="note">راح توصلك رسالة تأكيد—تأكد من صحة البيانات.</div>
    </form>
  </div>
</div>

<div class="toast" id="toast">تمت الإضافة إلى السلة ✅</div>

<script>
/* ========= بيانات المنتجات (عدّلها براحتك) ========= */
const PRODUCTS = [
  {id:1, name:"قميص كلاسيك", price:25000, category:"أزياء", stock:12, desc:"قماش قطني مريح", img:"shirt"},
  {id:2, name:"حقيبة يد", price:38000, category:"أزياء", stock:7, desc:"تصميم عملي يومي", img:"bag"},
  {id:3, name:"سماعات لاسلكية", price:55000, category:"إلكترونيات", stock:9, desc:"شحن سريع وصوت نقي", img:"buds"},
  {id:4, name:"كيبورد ميكانيكي", price:79000, category:"إلكترونيات", stock:5, desc:"إضاءة RGB و أزرار زرقاء", img:"keyboard"},
  {id:5, name:"كوب حراري", price:12000, category:"منزل", stock:20, desc:"يحافظ على الحرارة 6 ساعات", img:"mug"},
  {id:6, name:"دفتر ملاحظات", price:6000, category:"قرطاسية", stock:30, desc:"80 ورقة — غلاف قوي", img:"notebook"},
  {id:7, name:"عطر شرقي", price:45000, category:"جمال", stock:8, desc:"فوحان مميز يدوم طويلاً", img:"perfume"},
  {id:8, name:"ماوس لاسلكي", price:18000, category:"إلكترونيات", stock:15, desc:"مستشعر دقيق وهدوء بالنقر", img:"mouse"}
];
/* ========= إعدادات عامة ========= */
const IQD = new Intl.NumberFormat('ar-IQ',{style:'currency',currency:'IQD',maximumFractionDigits:0});
const ELS = sel => document.querySelector(sel);
const ELZ = sel => Array.from(document.querySelectorAll(sel));
const state = {
  products:[...PRODUCTS],
  cart: load('cart', []),
  coupon: load('coupon', null),
  shipping: 5000, // عدّل سعر التوصيل
};
function save(key,val){localStorage.setItem(key,JSON.stringify(val))}
function load(key,def){try{const v=localStorage.getItem(key);return v?JSON.parse(v):def}catch{ return def}}
function toast(msg){const t=ELS('#toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1600)}
/* ========= رسم المنتجات ========= */
function icon(kind){
  const map={
    shirt:'M12 3c3 0 5 2 5 5v2h2a2 2 0 1 1 0 4h-2v5a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2v-5H5a2 2 0 1 1 0-4h2V8c0-3 2-5 5-5Z',
    bag:'M7 9V7a5 5 0 0 1 10 0v2h2a2 2 0 0 1 2 2v8a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3v-8a2 2 0 0 1 2-2h2Zm2 0h6V7a3 3 0 0 0-6 0v2Z',
    buds:'M7 4a3 3 0 0 1 3 3v3a3 3 0 0 1-3 3H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1Zm10 0a3 3 0 0 1 3 3v3a3 3 0 0 1-3 3h-1a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1Z',
    keyboard:'M4 7h16a2 2 0 0 1 2 2v7a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V9a2 2 0 0 1 2-2Zm2 3h2v2H6v-2Zm4 0h2v2h-2v-2Zm4 0h2v2h-2v-2Zm-8 4h10v2H6v-2Z',
    mug:'M6 6h8a2 2 0 0 1 2 2v8a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V8a2 2 0 0 1 2-2Zm12 4h1a2 2 0 1 1 0 4h-1',
    notebook:'M6 5h9a2 2 0 0 1 2 2v12H6a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Zm0 0v14M9 5v14',
    perfume:'M10 3h4v3h-4V3Zm-2 5h8a2 2 0 0 1 2 2v7a3 3 0 0 1-3 3H9a3 3 0 0 1-3-3v-7a2 2 0 0 1 2-2Zm2 2h4',
    mouse:'M10 3h4a4 4 0 0 1 4 4v10a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V7a4 4 0 0 1 4-4Zm2 0v6'
  };
  return `<svg viewBox="0 0 24 24" fill="none" width="64" height="64">
    <path d="${map[kind]||map['bag']}" stroke="#22d3ee" stroke-width="1.6" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>`
}
function renderProducts(list){
  const wrap=ELS('#products');
  wrap.innerHTML='';
  if(!list.length){
    wrap.innerHTML = `<div class="empty">لا توجد منتجات حسب البحث/الفلترة.</div>`;
    return;
  }
  list.forEach(p=>{
    const el=document.createElement('div');
    el.className='card';
    el.innerHTML=`
      <div class="img">${icon(p.img)}</div>
      <div class="content">
        <div class="row"><div class="title">${p.name}</div><span class="badge">${p.category}</span></div>
        <div class="muted">${p.desc}</div>
        <div class="price"><strong>${IQD.format(p.price)}</strong> <span class="muted">المتوفر: ${p.stock}</span></div>
        <div class="row" style="margin-top:10px">
          <button class="btn small" onclick="addToCart(${p.id})">إضافة للسلة</button>
          <button class="btn small" onclick="quickBuy(${p.id})">شراء سريع</button>
        </div>
      </div>`;
    wrap.appendChild(el);
  });
}
/* ========= فلترة وبحث ========= */
function initFilters(){
  const catSel=ELS('#category');
  const cats=[...new Set(PRODUCTS.map(p=>p.category))];
  cats.forEach(c=>{
    const opt=document.createElement('option');opt.value=c;opt.textContent=c;catSel.appendChild(opt);
  });
  const apply=()=>{
    const q=ELS('#search').value.trim().toLowerCase();
    const cat=catSel.value;
    const filtered=PRODUCTS.filter(p=>{
      const okCat = (cat==='all') || (p.category===cat);
      const okQ = !q || [p.name,p.desc,p.category].join(' ').toLowerCase().includes(q);
      return okCat && okQ;
    });
    renderProducts(filtered);
  };
  ELS('#search').addEventListener('input',apply);
  catSel.addEventListener('change',apply);
  ELS('#reset').addEventListener('click',()=>{
    ELS('#search').value='';catSel.value='all';renderProducts(PRODUCTS);
  });
}
/* ========= السلة ========= */
function addToCart(id,qty=1){
  const prod=PRODUCTS.find(p=>p.id===id); if(!prod) return;
  const it=state.cart.find(i=>i.id===id);
  if(it){it.qty=Math.min(it.qty+qty, prod.stock)}
  else state.cart.push({id,qty:Math.min(qty, prod.stock)});
  save('cart',state.cart);
  updateCartUI();
  toast('تمت الإضافة إلى السلة ✅');
}
function quickBuy(id){
  addToCart(id,1);
  openDrawer();
}
function cartItemsDetailed(){
  return state.cart.map(i=>{
    const p=PRODUCTS.find(x=>x.id===i.id);
    return {...p, qty:i.qty, line:p.price*i.qty}
  });
}
function setQty(id,delta){
  const it=state.cart.find(i=>i.id===id); if(!it) return;
  const prod=PRODUCTS.find(p=>p.id===id);
  it.qty=Math.max(1, Math.min((it.qty||1)+delta, prod.stock));
  save('cart',state.cart); updateCartUI();
}
function removeItem(id){
  state.cart = state.cart.filter(i=>i.id!==id);
  save('cart',state.cart); updateCartUI();
}
function clearCart(){ state.cart=[]; save('cart',state.cart); updateCartUI() }
function openDrawer(){ELS('#drawer').classList.add('open')}
function closeDrawer(){ELS('#drawer').classList.remove('open')}
function updateCartUI(){
  const items=cartItemsDetailed();
  ELS('#cartCount').textContent = state.cart.reduce((a,b)=>a+b.qty,0);
  const body=ELS('#cartBody');
  if(!items.length){ body.innerHTML=`<div class="empty">سلتك فارغة.</div>`; }
  else{
    body.innerHTML = items.map(i=>`
      <div class="item">
        <div style="background:#0a1020;border:1px solid #1f2937;border-radius:10px;width:52px;height:52px;display:grid;place-items:center">${icon(i.img)}</div>
        <div>
          <div class="row"><div class="title">${i.name}</div><button class="btn small" onclick="removeItem(${i.id})">حذف</button></div>
          <div class="muted">${IQD.format(i.price)} × ${i.qty} = <b>${IQD.format(i.line)}</b></div>
          <div class="qty" style="margin-top:6px">
            <button onclick="setQty(${i.id},-1)">−</button>
            <div>${i.qty}</div>
            <button onclick="setQty(${i.id},1)">+</button>
          </div>
        </div>
        <div></div>
      </div>
    `).join('');
  }
  // totals
  const sub = items.reduce((a,b)=>a+b.line,0);
  const discount = calcDiscount(sub, state.coupon);
  const shipping = items.length? state.shipping : 0;
  const grand = Math.max(0, sub - discount) + shipping;
  ELS('#subTotal').textContent = IQD.format(sub);
  ELS('#discount').textContent = `− ${IQD.format(discount)}`;
  ELS('#shipping').textContent = IQD.format(shipping);
  ELS('#grandTotal').textContent = IQD.format(grand);
}
function calcDiscount(sub,coupon){
  if(!coupon) return 0;
  // أمثلة أكواد: SAVE10 (10%), IRAQ5K (خصم 5000)
  if(coupon==='SAVE10') return Math.round(sub*0.10);
  if(coupon==='IRAQ5K') return Math.min(5000, sub);
  return 0;
}
/* ========= الكوبون ========= */
function applyCoupon(){
  const code = ELS('#coupon').value.trim().toUpperCase();
  state.coupon = code || null;
  save('coupon', state.coupon);
  updateCartUI();
  toast(state.coupon? `تم تطبيق الكوبون: ${state.coupon}` : 'تم إلغاء الكوبون');
}
/* ========= إتمام الطلب ========= */
function openModal(){ELS('#modal').classList.add('open')}
function closeModal(){ELS('#modal').classList.remove('open')}
function orderSummary(){
  const items=cartItemsDetailed();
  const sub = items.reduce((a,b)=>a+b.line,0);
  const discount = calcDiscount(sub, state.coupon);
  const shipping = items.length? state.shipping : 0;
  const grand = Math.max(0, sub - discount) + shipping;
  return {items, sub, discount, shipping, grand};
}
function buildWhatsMessage(customer){
  const {items, sub, discount, shipping, grand} = orderSummary();
  const lines = [
    `طلب جديد من المتجر:`,
    `الاسم: ${customer.name}`,
    `الهاتف: ${customer.phone}`,
    `المدينة: ${customer.city}`,
    `العنوان: ${customer.address}`,
    `--- المنتجات ---`,
    ...items.map(i=>`- ${i.name} × ${i.qty} = ${i.line} IQD`),
    `----------------`,
    `الإجمالي الفرعي: ${sub} IQD`,
    `الخصم: ${discount} IQD`,
    `التوصيل: ${shipping} IQD`,
    `المجموع: ${grand} IQD`
  ];
  return encodeURIComponent(lines.join('\n'));
}
function sendWhats(){
  const name=ELS('#name').value.trim();
  const phone=ELS('#phone').value.trim();
  const city=ELS('#city').value.trim();
  const address=ELS('#address').value.trim();
  const whats=ELS('#whatsNumber').value.replace(/\D/g,'');
  if(!name||!phone||!city||!address){ toast('أكمل البيانات أولاً'); return; }
  if(!whats){ toast('أدخل رقم واتساب أو استعمل زر تأكيد الطلب'); return; }
  const msg = buildWhatsMessage({name,phone,city,address});
  const url = `https://wa.me/${whats}?text=${msg}`;
  window.open(url,'_blank');
}
function submitOrder(e){
  e.preventDefault();
  // هنا ممكن تحفظ الطلب محلياً أو ترسله لخدمة خارجية لاحقاً
  toast('تم إرسال الطلب (تجريبي). شكراً لك!'); 
  closeModal(); closeDrawer();
  clearCart();
}
/* ========= أحداث واجهة ========= */
document.addEventListener('DOMContentLoaded', ()=>{
  renderProducts(PRODUCTS);
  initFilters();
  updateCartUI();
  // أزرار السلة
  ELS('#openCart').addEventListener('click', openDrawer);
  ELS('#closeCart').addEventListener('click', closeDrawer);
  // كوبون
  ELS('#applyCoupon').addEventListener('click', applyCoupon);
  // الدفع
  ELS('#checkoutBtn').addEventListener('click', ()=>{
    if(!state.cart.length){ toast('السلة فارغة'); return; }
    openModal();
  });
  ELS('#closeModal').addEventListener('click', closeModal);
  ELS('#checkoutForm').addEventListener('submit', submitOrder);
  ELS('#sendWhats').addEventListener('click', sendWhats);
});
</script>
</body>
</html>
