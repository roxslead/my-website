<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù…ØªØ¬Ø±ÙŠ â€” Ù…Ù„Ù ÙˆØ§Ø­Ø¯</title>
<style>
  :root{
    --bg:#0f172a;--card:#111827;--muted:#94a3b8;--text:#e5e7eb;--brand:#06b6d4;--brand2:#22d3ee;--ok:#22c55e;--warn:#f59e0b;--danger:#ef4444;
    --radius:20px
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(120deg,#0b1022,#0f172a 40%,#0b1323);font-family:system-ui,Segoe UI,Roboto,Arial; color:var(--text);}
  a{color:inherit}
  .container{max-width:1100px;margin:0 auto;padding:16px}
  header{position:sticky;top:0;z-index:50;background:rgba(15,23,42,.55);backdrop-filter: blur(10px);border-bottom:1px solid #1f2937}
  .nav{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px 4px}
  .brand{display:flex;align-items:center;gap:10px;font-weight:800;font-size:20px}
  .logo{width:34px;height:34px;border-radius:12px;background:conic-gradient(from 0deg,var(--brand),var(--brand2));display:grid;place-items:center;color:#041014;font-weight:900}
  .tools{display:flex;gap:8px;flex-wrap:wrap}
  .chip{background:#0b1222;border:1px solid #1f2937;color:var(--muted);padding:10px 12px;border-radius:12px;display:flex;gap:8px;align-items:center}
  .chip input, .chip select{background:transparent;border:none;outline:none;color:#e5e7eb}
  .chip input::placeholder{color:#64748b}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
  @media(max-width:980px){.grid{grid-template-columns:repeat(3,1fr)}}
  @media(max-width:720px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media(max-width:480px){.grid{grid-template-columns:1fr}}
  .card{background:linear-gradient(180deg,#0e152a,#0a1020);border:1px solid #1f2937;border-radius:var(--radius);overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .img{aspect-ratio:4/3;background:#0a1326;display:grid;place-items:center;border-bottom:1px solid #1f2937}
  .img svg{width:64px;height:64px;opacity:.7}
  .content{padding:14px}
  .title{font-weight:700}
  .muted{color:var(--muted);font-size:13px}
  .price{display:flex;align-items:center;gap:8px;margin-top:8px}
  .badge{font-size:12px;color:#0b1222;background:linear-gradient(90deg,var(--brand),var(--brand2));padding:4px 8px;border-radius:999px}
  .row{display:flex;justify-content:space-between;align-items:center;gap:10px}
  .btn{cursor:pointer;background:#0b1222;border:1px solid #1f2937;color:#e5e7eb;padding:10px 12px;border-radius:12px}
  .btn:hover{border-color:#334155}
  .btn.brand{background:linear-gradient(120deg,var(--brand),var(--brand2));color:#061019;border:none}
  .btn.small{padding:6px 10px;font-size:13px}
  /* cart drawer */
  .cart-toggle{position:fixed;right:16px;bottom:16px;z-index:60}
  .fab{display:flex;align-items:center;gap:8px;padding:12px 14px;border-radius:999px;background:linear-gradient(120deg,var(--brand),var(--brand2));color:#041014;border:none;box-shadow:0 10px 30px rgba(0,0,0,.35);font-weight:800;cursor:pointer}
  .drawer{position:fixed;inset:0 0 0 auto;width:min(420px,100%);background:linear-gradient(180deg,#0a1020,#0b1222);border-left:1px solid #1f2937;transform:translateX(105%);transition:.35s ease;z-index:70;display:flex;flex-direction:column}
  .drawer.open{transform:translateX(0)}
  .drawer header{position:sticky;top:0;border-bottom:1px solid #1f2937;background:transparent}
  .drawer .body{padding:16px;display:flex;flex-direction:column;gap:10px;overflow:auto}
  .item{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;background:#0b1426;border:1px solid #1f2937;border-radius:14px;padding:10px}
  .qty{display:flex;align-items:center;gap:6px}
  .qty button{width:28px;height:28px;border-radius:8px;border:1px solid #273244;background:#0b1222;color:#e5e7eb;cursor:pointer}
  .line{display:flex;justify-content:space-between;color:#cbd5e1}
  .total{font-size:20px;font-weight:900}
  .coupon{display:flex;gap:8px}
  .coupon input{flex:1}
  .foot{padding:16px;border-top:1px solid #1f2937;display:grid;gap:8px}
  .note{font-size:12px;color:#94a3b8}
  /* toast */
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:92px;background:#0b1426;border:1px solid #1f2937;padding:10px 14px;border-radius:12px;color:#e5e7eb;box-shadow:0 10px 24px rgba(0,0,0,.3);opacity:0;pointer-events:none;transition:.3s}
  .toast.show{opacity:1}
  /* modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:80;padding:16px}
  .modal.open{display:flex}
  .modal .box{width:min(520px,100%);background:#0b1426;border:1px solid #1f2937;border-radius:20px;padding:16px;display:grid;gap:10px}
  .form{display:grid;gap:10px}
  .form .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .form input, .form textarea{background:#0a1020;border:1px solid #1f2937;color:#e5e7eb;padding:10px;border-radius:12px;outline:none}
  .whats{display:flex;gap:8px}
  .whats input{flex:1}
  .empty{padding:24px;border:1px dashed #334155;border-radius:14px;text-align:center;color:#94a3b8}
  footer{opacity:.7;font-size:12px;margin:24px 0;text-align:center}
</style>
</head>
<body>

<header>
  <div class="container nav">
    <div class="brand">
      <div class="logo">ğŸ›ï¸</div>
      <span>Ù…ØªØ¬Ø±ÙŠ</span>
    </div>
    <div class="tools">
      <label class="chip"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="#94a3b8" stroke-width="2" stroke-linecap="round"/></svg>
        <input id="search" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." />
      </label>
      <label class="chip">
        Ø§Ù„ØªØµÙ†ÙŠÙ
        <select id="category">
          <option value="all">Ø§Ù„ÙƒÙ„</option>
        </select>
      </label>
      <button class="chip btn small" id="reset">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
    </div>
  </div>
</header>

<main class="container" style="padding-top:18px">
  <div id="products" class="grid"></div>
  <footer>Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù…Ù„Ù ÙˆØ§Ø­Ø¯ â€” ØªØ­ÙØ¸ Ø§Ù„Ø³Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.</footer>
</main>

<!-- Cart Floating Button -->
<div class="cart-toggle">
  <button class="fab" id="openCart">
    <span id="cartCount">0</span> ÙÙŠ Ø§Ù„Ø³Ù„Ø©
  </button>
</div>

<!-- Cart Drawer -->
<aside class="drawer" id="drawer">
  <header class="nav container">
    <div class="brand"><div class="logo">ğŸ§¾</div><span>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</span></div>
    <button class="btn small" id="closeCart">Ø¥ØºÙ„Ø§Ù‚</button>
  </header>
  <div class="body" id="cartBody"></div>
  <div class="foot">
    <div class="coupon">
      <input id="coupon" placeholder="ÙƒÙˆØ¯ Ø®ØµÙ… (Ù…Ø«Ø§Ù„: SAVE10)" />
      <button class="btn small" id="applyCoupon">ØªØ·Ø¨ÙŠÙ‚</button>
    </div>
    <div class="line"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ</span><span id="subTotal">0</span></div>
    <div class="line"><span>Ø§Ù„Ø®ØµÙ…</span><span id="discount">0</span></div>
    <div class="line"><span>Ø§Ù„ØªÙˆØµÙŠÙ„</span><span id="shipping">0</span></div>
    <div class="line total"><span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</span><span id="grandTotal">0</span></div>
    <button class="btn brand" id="checkoutBtn">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
    <div class="note">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø£Ùˆ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨. Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ø§Ù„Ù€ <b>IQD</b>.</div>
  </div>
</aside>

<!-- Checkout Modal -->
<div class="modal" id="modal">
  <div class="box">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h3 style="margin:0">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</h3>
      <button class="btn small" id="closeModal">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    <form class="form" id="checkoutForm">
      <div class="row2">
        <input required id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" />
        <input required id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" />
      </div>
      <input required id="city" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©" />
      <textarea required id="address" rows="3" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„"></textarea>
      <div class="whats">
        <input id="whatsNumber" placeholder="Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨)" />
        <button type="button" class="btn small" id="sendWhats">Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨</button>
      </div>
      <button class="btn brand" type="submit">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ (Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…)</button>
      <div class="note">Ø±Ø§Ø­ ØªÙˆØµÙ„Ùƒ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯â€”ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</div>
    </form>
  </div>
</div>

<div class="toast" id="toast">ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© âœ…</div>

<script>
/* ========= Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø¹Ø¯Ù‘Ù„Ù‡Ø§ Ø¨Ø±Ø§Ø­ØªÙƒ) ========= */
const PRODUCTS = [
  {id:1, name:"Ù‚Ù…ÙŠØµ ÙƒÙ„Ø§Ø³ÙŠÙƒ", price:25000, category:"Ø£Ø²ÙŠØ§Ø¡", stock:12, desc:"Ù‚Ù…Ø§Ø´ Ù‚Ø·Ù†ÙŠ Ù…Ø±ÙŠØ­", img:"shirt"},
  {id:2, name:"Ø­Ù‚ÙŠØ¨Ø© ÙŠØ¯", price:38000, category:"Ø£Ø²ÙŠØ§Ø¡", stock:7, desc:"ØªØµÙ…ÙŠÙ… Ø¹Ù…Ù„ÙŠ ÙŠÙˆÙ…ÙŠ", img:"bag"},
  {id:3, name:"Ø³Ù…Ø§Ø¹Ø§Øª Ù„Ø§Ø³Ù„ÙƒÙŠØ©", price:55000, category:"Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª", stock:9, desc:"Ø´Ø­Ù† Ø³Ø±ÙŠØ¹ ÙˆØµÙˆØª Ù†Ù‚ÙŠ", img:"buds"},
  {id:4, name:"ÙƒÙŠØ¨ÙˆØ±Ø¯ Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ", price:79000, category:"Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª", stock:5, desc:"Ø¥Ø¶Ø§Ø¡Ø© RGB Ùˆ Ø£Ø²Ø±Ø§Ø± Ø²Ø±Ù‚Ø§Ø¡", img:"keyboard"},
  {id:5, name:"ÙƒÙˆØ¨ Ø­Ø±Ø§Ø±ÙŠ", price:12000, category:"Ù…Ù†Ø²Ù„", stock:20, desc:"ÙŠØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø±Ø§Ø±Ø© 6 Ø³Ø§Ø¹Ø§Øª", img:"mug"},
  {id:6, name:"Ø¯ÙØªØ± Ù…Ù„Ø§Ø­Ø¸Ø§Øª", price:6000, category:"Ù‚Ø±Ø·Ø§Ø³ÙŠØ©", stock:30, desc:"80 ÙˆØ±Ù‚Ø© â€” ØºÙ„Ø§Ù Ù‚ÙˆÙŠ", img:"notebook"},
  {id:7, name:"Ø¹Ø·Ø± Ø´Ø±Ù‚ÙŠ", price:45000, category:"Ø¬Ù…Ø§Ù„", stock:8, desc:"ÙÙˆØ­Ø§Ù† Ù…Ù…ÙŠØ² ÙŠØ¯ÙˆÙ… Ø·ÙˆÙŠÙ„Ø§Ù‹", img:"perfume"},
  {id:8, name:"Ù…Ø§ÙˆØ³ Ù„Ø§Ø³Ù„ÙƒÙŠ", price:18000, category:"Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª", stock:15, desc:"Ù…Ø³ØªØ´Ø¹Ø± Ø¯Ù‚ÙŠÙ‚ ÙˆÙ‡Ø¯ÙˆØ¡ Ø¨Ø§Ù„Ù†Ù‚Ø±", img:"mouse"}
];
/* ========= Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© ========= */
const IQD = new Intl.NumberFormat('ar-IQ',{style:'currency',currency:'IQD',maximumFractionDigits:0});
const ELS = sel => document.querySelector(sel);
const ELZ = sel => Array.from(document.querySelectorAll(sel));
const state = {
  products:[...PRODUCTS],
  cart: load('cart', []),
  coupon: load('coupon', null),
  shipping: 5000, // Ø¹Ø¯Ù‘Ù„ Ø³Ø¹Ø± Ø§Ù„ØªÙˆØµÙŠÙ„
};
function save(key,val){localStorage.setItem(key,JSON.stringify(val))}
function load(key,def){try{const v=localStorage.getItem(key);return v?JSON.parse(v):def}catch{ return def}}
function toast(msg){const t=ELS('#toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1600)}
/* ========= Ø±Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ========= */
function icon(kind){
  const map={
    shirt:'M12 3c3 0 5 2 5 5v2h2a2 2 0 1 1 0 4h-2v5a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2v-5H5a2 2 0 1 1 0-4h2V8c0-3 2-5 5-5Z',
    bag:'M7 9V7a5 5 0 0 1 10 0v2h2a2 2 0 0 1 2 2v8a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3v-8a2 2 0 0 1 2-2h2Zm2 0h6V7a3 3 0 0 0-6 0v2Z',
    buds:'M7 4a3 3 0 0 1 3 3v3a3 3 0 0 1-3 3H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1Zm10 0a3 3 0 0 1 3 3v3a3 3 0 0 1-3 3h-1a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1Z',
    keyboard:'M4 7h16a2 2 0 0 1 2 2v7a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V9a2 2 0 0 1 2-2Zm2 3h2v2H6v-2Zm4 0h2v2h-2v-2Zm4 0h2v2h-2v-2Zm-8 4h10v2H6v-2Z',
    mug:'M6 6h8a2 2 0 0 1 2 2v8a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V8a2 2 0 0 1 2-2Zm12 4h1a2 2 0 1 1 0 4h-1',
    notebook:'M6 5h9a2 2 0 0 1 2 2v12H6a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Zm0 0v14M9 5v14',
    perfume:'M10 3h4v3h-4V3Zm-2 5h8a2 2 0 0 1 2 2v7a3 3 0 0 1-3 3H9a3 3 0 0 1-3-3v-7a2 2 0 0 1 2-2Zm2 2h4',
    mouse:'M10 3h4a4 4 0 0 1 4 4v10a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V7a4 4 0 0 1 4-4Zm2 0v6'
  };
  return `<svg viewBox="0 0 24 24" fill="none" width="64" height="64">
    <path d="${map[kind]||map['bag']}" stroke="#22d3ee" stroke-width="1.6" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>`
}
function renderProducts(list){
  const wrap=ELS('#products');
  wrap.innerHTML='';
  if(!list.length){
    wrap.innerHTML = `<div class="empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«/Ø§Ù„ÙÙ„ØªØ±Ø©.</div>`;
    return;
  }
  list.forEach(p=>{
    const el=document.createElement('div');
    el.className='card';
    el.innerHTML=`
      <div class="img">${icon(p.img)}</div>
      <div class="content">
        <div class="row"><div class="title">${p.name}</div><span class="badge">${p.category}</span></div>
        <div class="muted">${p.desc}</div>
        <div class="price"><strong>${IQD.format(p.price)}</strong> <span class="muted">Ø§Ù„Ù…ØªÙˆÙØ±: ${p.stock}</span></div>
        <div class="row" style="margin-top:10px">
          <button class="btn small" onclick="addToCart(${p.id})">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
          <button class="btn small" onclick="quickBuy(${p.id})">Ø´Ø±Ø§Ø¡ Ø³Ø±ÙŠØ¹</button>
        </div>
      </div>`;
    wrap.appendChild(el);
  });
}
/* ========= ÙÙ„ØªØ±Ø© ÙˆØ¨Ø­Ø« ========= */
function initFilters(){
  const catSel=ELS('#category');
  const cats=[...new Set(PRODUCTS.map(p=>p.category))];
  cats.forEach(c=>{
    const opt=document.createElement('option');opt.value=c;opt.textContent=c;catSel.appendChild(opt);
  });
  const apply=()=>{
    const q=ELS('#search').value.trim().toLowerCase();
    const cat=catSel.value;
    const filtered=PRODUCTS.filter(p=>{
      const okCat = (cat==='all') || (p.category===cat);
      const okQ = !q || [p.name,p.desc,p.category].join(' ').toLowerCase().includes(q);
      return okCat && okQ;
    });
    renderProducts(filtered);
  };
  ELS('#search').addEventListener('input',apply);
  catSel.addEventListener('change',apply);
  ELS('#reset').addEventListener('click',()=>{
    ELS('#search').value='';catSel.value='all';renderProducts(PRODUCTS);
  });
}
/* ========= Ø§Ù„Ø³Ù„Ø© ========= */
function addToCart(id,qty=1){
  const prod=PRODUCTS.find(p=>p.id===id); if(!prod) return;
  const it=state.cart.find(i=>i.id===id);
  if(it){it.qty=Math.min(it.qty+qty, prod.stock)}
  else state.cart.push({id,qty:Math.min(qty, prod.stock)});
  save('cart',state.cart);
  updateCartUI();
  toast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© âœ…');
}
function quickBuy(id){
  addToCart(id,1);
  openDrawer();
}
function cartItemsDetailed(){
  return state.cart.map(i=>{
    const p=PRODUCTS.find(x=>x.id===i.id);
    return {...p, qty:i.qty, line:p.price*i.qty}
  });
}
function setQty(id,delta){
  const it=state.cart.find(i=>i.id===id); if(!it) return;
  const prod=PRODUCTS.find(p=>p.id===id);
  it.qty=Math.max(1, Math.min((it.qty||1)+delta, prod.stock));
  save('cart',state.cart); updateCartUI();
}
function removeItem(id){
  state.cart = state.cart.filter(i=>i.id!==id);
  save('cart',state.cart); updateCartUI();
}
function clearCart(){ state.cart=[]; save('cart',state.cart); updateCartUI() }
function openDrawer(){ELS('#drawer').classList.add('open')}
function closeDrawer(){ELS('#drawer').classList.remove('open')}
function updateCartUI(){
  const items=cartItemsDetailed();
  ELS('#cartCount').textContent = state.cart.reduce((a,b)=>a+b.qty,0);
  const body=ELS('#cartBody');
  if(!items.length){ body.innerHTML=`<div class="empty">Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©.</div>`; }
  else{
    body.innerHTML = items.map(i=>`
      <div class="item">
        <div style="background:#0a1020;border:1px solid #1f2937;border-radius:10px;width:52px;height:52px;display:grid;place-items:center">${icon(i.img)}</div>
        <div>
          <div class="row"><div class="title">${i.name}</div><button class="btn small" onclick="removeItem(${i.id})">Ø­Ø°Ù</button></div>
          <div class="muted">${IQD.format(i.price)} Ã— ${i.qty} = <b>${IQD.format(i.line)}</b></div>
          <div class="qty" style="margin-top:6px">
            <button onclick="setQty(${i.id},-1)">âˆ’</button>
            <div>${i.qty}</div>
            <button onclick="setQty(${i.id},1)">+</button>
          </div>
        </div>
        <div></div>
      </div>
    `).join('');
  }
  // totals
  const sub = items.reduce((a,b)=>a+b.line,0);
  const discount = calcDiscount(sub, state.coupon);
  const shipping = items.length? state.shipping : 0;
  const grand = Math.max(0, sub - discount) + shipping;
  ELS('#subTotal').textContent = IQD.format(sub);
  ELS('#discount').textContent = `âˆ’ ${IQD.format(discount)}`;
  ELS('#shipping').textContent = IQD.format(shipping);
  ELS('#grandTotal').textContent = IQD.format(grand);
}
function calcDiscount(sub,coupon){
  if(!coupon) return 0;
  // Ø£Ù…Ø«Ù„Ø© Ø£ÙƒÙˆØ§Ø¯: SAVE10 (10%), IRAQ5K (Ø®ØµÙ… 5000)
  if(coupon==='SAVE10') return Math.round(sub*0.10);
  if(coupon==='IRAQ5K') return Math.min(5000, sub);
  return 0;
}
/* ========= Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† ========= */
function applyCoupon(){
  const code = ELS('#coupon').value.trim().toUpperCase();
  state.coupon = code || null;
  save('coupon', state.coupon);
  updateCartUI();
  toast(state.coupon? `ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†: ${state.coupon}` : 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†');
}
/* ========= Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ ========= */
function openModal(){ELS('#modal').classList.add('open')}
function closeModal(){ELS('#modal').classList.remove('open')}
function orderSummary(){
  const items=cartItemsDetailed();
  const sub = items.reduce((a,b)=>a+b.line,0);
  const discount = calcDiscount(sub, state.coupon);
  const shipping = items.length? state.shipping : 0;
  const grand = Math.max(0, sub - discount) + shipping;
  return {items, sub, discount, shipping, grand};
}
function buildWhatsMessage(customer){
  const {items, sub, discount, shipping, grand} = orderSummary();
  const lines = [
    `Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±:`,
    `Ø§Ù„Ø§Ø³Ù…: ${customer.name}`,
    `Ø§Ù„Ù‡Ø§ØªÙ: ${customer.phone}`,
    `Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${customer.city}`,
    `Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${customer.address}`,
    `--- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ---`,
    ...items.map(i=>`- ${i.name} Ã— ${i.qty} = ${i.line} IQD`),
    `----------------`,
    `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ: ${sub} IQD`,
    `Ø§Ù„Ø®ØµÙ…: ${discount} IQD`,
    `Ø§Ù„ØªÙˆØµÙŠÙ„: ${shipping} IQD`,
    `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${grand} IQD`
  ];
  return encodeURIComponent(lines.join('\n'));
}
function sendWhats(){
  const name=ELS('#name').value.trim();
  const phone=ELS('#phone').value.trim();
  const city=ELS('#city').value.trim();
  const address=ELS('#address').value.trim();
  const whats=ELS('#whatsNumber').value.replace(/\D/g,'');
  if(!name||!phone||!city||!address){ toast('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹'); return; }
  if(!whats){ toast('Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø£Ùˆ Ø§Ø³ØªØ¹Ù…Ù„ Ø²Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨'); return; }
  const msg = buildWhatsMessage({name,phone,city,address});
  const url = `https://wa.me/${whats}?text=${msg}`;
  window.open(url,'_blank');
}
function submitOrder(e){
  e.preventDefault();
  // Ù‡Ù†Ø§ Ù…Ù…ÙƒÙ† ØªØ­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø£Ùˆ ØªØ±Ø³Ù„Ù‡ Ù„Ø®Ø¯Ù…Ø© Ø®Ø§Ø±Ø¬ÙŠØ© Ù„Ø§Ø­Ù‚Ø§Ù‹
  toast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (ØªØ¬Ø±ÙŠØ¨ÙŠ). Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ!'); 
  closeModal(); closeDrawer();
  clearCart();
}
/* ========= Ø£Ø­Ø¯Ø§Ø« ÙˆØ§Ø¬Ù‡Ø© ========= */
document.addEventListener('DOMContentLoaded', ()=>{
  renderProducts(PRODUCTS);
  initFilters();
  updateCartUI();
  // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³Ù„Ø©
  ELS('#openCart').addEventListener('click', openDrawer);
  ELS('#closeCart').addEventListener('click', closeDrawer);
  // ÙƒÙˆØ¨ÙˆÙ†
  ELS('#applyCoupon').addEventListener('click', applyCoupon);
  // Ø§Ù„Ø¯ÙØ¹
  ELS('#checkoutBtn').addEventListener('click', ()=>{
    if(!state.cart.length){ toast('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©'); return; }
    openModal();
  });
  ELS('#closeModal').addEventListener('click', closeModal);
  ELS('#checkoutForm').addEventListener('submit', submitOrder);
  ELS('#sendWhats').addEventListener('click', sendWhats);
});
</script>
</body>
</html>
